plugins {
    id 'java'
    id 'org.springframework.boot' version '2.4.4'
    id 'io.spring.dependency-management' version '1.0.11.RELEASE'
    id 'com.google.cloud.tools.jib' version '3.0.0'
}

// === Repository config ===
repositories {
    mavenLocal()
    mavenCentral()
}

// === JAVA configuration ===
compileJava {
    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11
}

// === Dependencies ===
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    runtimeOnly 'com.h2database:h2'
    //testing
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'org.junit.jupiter:junit-jupiter'
}

tasks.withType(Test) {
    useJUnitPlatform()
}

test {
    exclude '**/*IntegrationTest*'
}

task integrationTest(type: Test) {
    group 'verification'
    include '**/*IntegrationTest*'
    it.mustRunAfter test
}

// === Spring Boot Configuration ===
springBoot {
	buildInfo()
}

// === Wrapper Configuration ===
wrapper {
    distributionType = Wrapper.DistributionType.ALL
}

bootBuildImage {
    verboseLogging = false

    //fix version of used images
    builder = "paketobuildpacks/builder@sha256:2fbe23a13024af36db7c05b00b58361f4e4aed8eb679519daafd035f653098fb"
    runImage = "paketobuildpacks/run@sha256:0cb3de382afbd5da1e01515f55ab017011ac4d76c77fabb44006f0d0546b2722"
    environment = [
            "BP_DEBUG_ENABLED"                     : "true",
            "BPE_DELIM_JAVA_TOOL_OPTIONS"          : " ",
            "BPE_JAVA_TOOL_OPTIONS"                : "-Dfile.encoding=UTF-8",
            "BPE_BPL_SPRING_CLOUD_BINDINGS_ENABLED": "false"
    ]
    publish = false
}

jib {
}
